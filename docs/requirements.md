# 学習管理アプリケーション 要件定義書

**データモデル詳細**: [data-model.md](./data-model.md) を参照

---

## 1. 認証機能（Authentication）

学習記録を個人ごとに管理するため、ログイン・サインアップ機能を実装します。

### 認証方式

- **認証プロバイダー**: Supabase Auth（メール＋パスワード）
- **認証方法**: メールアドレスとパスワードでサインアップ・ログイン

### サインアップ画面

新規ユーザーがアカウントを作成する画面です。

- **入力項目**:
    - メールアドレス（必須）
    - パスワード（必須、8文字以上）
    - パスワード確認（必須、パスワードと一致必須）
- **バリデーション**:
    - メールアドレス形式のチェック
    - パスワードの長さチェック（8文字以上）
    - パスワードと確認用パスワードの一致チェック
- **サインアップボタン**:
    - 押下でSupabaseにアカウント作成リクエスト
    - 成功時はメール確認の案内を表示
    - エラー時は適切なエラーメッセージを表示
- **ログイン画面へのリンク**: 既にアカウントを持っている場合はログイン画面へ遷移

### メール確認

- Supabaseから確認メールが送信される
- ユーザーはメール内のリンクをクリックして認証を完了
- 確認完了後、ログイン画面へ誘導

### ログイン画面

既存ユーザーがログインする画面です。

- **入力項目**:
    - メールアドレス（必須）
    - パスワード（必須）
- **ログインボタン**:
    - 押下でSupabaseに認証リクエスト
    - 成功時はホーム画面（ダッシュボード）へ遷移
    - エラー時は適切なエラーメッセージを表示（「メールアドレスまたはパスワードが間違っています」）
- **サインアップ画面へのリンク**: アカウントを持っていない場合はサインアップ画面へ遷移
- **パスワードリセットリンク**: パスワードを忘れた場合はパスワードリセット画面へ遷移

### パスワードリセット画面

パスワードを忘れたユーザーがパスワードをリセットする画面です。

- **入力項目**:
    - メールアドレス（必須）
- **リセットメール送信ボタン**:
    - 押下でSupabaseにパスワードリセットメール送信リクエスト
    - 成功時は「リセットメールを送信しました」と表示
    - エラー時は適切なエラーメッセージを表示
- **ログイン画面へのリンク**: ログイン画面に戻る

### ログアウト機能

- **設定画面にログアウトボタンを追加**
- 押下でSupabaseからログアウト
- ログアウト後はログイン画面へ遷移

### 認証状態の管理

- **未認証ユーザーのアクセス制御**:
    - 未認証ユーザーは全ての画面にアクセスできない
    - 自動的にログイン画面へリダイレクト
- **認証済みユーザー**:
    - 全ての機能にアクセス可能
    - ユーザーIDに紐づいた学習記録のみを表示

### 初回ログイン時のフロー

- 初回ログイン時は、目標の有無で初期設定が必要かどうかを判定
- 目標が未設定（Bronze/Silver/Goldのいずれか1つでも未設定）の場合は、**初期目標設定画面へ自動遷移**
- すべての目標が設定済みの場合は、通常のホーム画面へ遷移

### 初期目標設定画面

初回ログイン時に、Bronze/Silver/Goldの3つの目標を設定する画面です。

**アクセス条件**:
- ログイン直後、目標が未設定の場合に自動的に遷移
- 目標が1つでも未設定の場合はこの画面を表示
- サイドバーやナビゲーションからは直接アクセス不可（初回のみ）

**画面構成**:
- **タイトル**: 「目標を設定しましょう」
- **説明文**: 「学習を続けるために、3つのレベルの目標を設定します。Bronze（最低限）、Silver（計画通り）、Gold（期待以上）の順に設定してください。」
- **入力フォーム**:
  - **Bronze目標**: テキスト入力（必須）
    - プレースホルダー: 「例：30分だけ座って作業する」
  - **Silver目標**: テキスト入力（必須）
    - プレースホルダー: 「例：1機能を完成させる」
  - **Gold目標**: テキスト入力（必須）
    - プレースホルダー: 「例：リファクタリングまで完了する」
- **保存ボタン**: 「目標を保存して開始」
  - すべての目標が入力されている場合のみ有効化
  - 押下で目標をデータベースに保存し、ホーム画面へ遷移

**バリデーション**:
- すべての目標が入力されていない場合は、保存ボタンを無効化
- 各目標は最低1文字以上の入力が必要

**保存時の処理**:
1. `goals`テーブルに3つの目標を登録（Bronze/Silver/Gold）
2. `goal_history_slots`テーブルに初期スロットを作成（変更理由: `initial`）
3. 保存完了後、ホーム画面へ自動遷移

---

## 2. 共通レイアウト（Layout）

|**項目**|**種別**|**内容・機能**|
|---|---|---|
|**ヘッダー：ストリーク**|表示|現在の連続達成日数（例：`🔥 12 days`）を表示。Bronze以上を連続で達成した日数をカウント。**当日の記録がまだない場合は、昨日までの連続達成日数を表示する。** 記録をしなかった日（当日を除く）があった場合はリセットされる。ストリーク日数は`daily_records`テーブルから動的に計算される。|
|**ヘッダー：記録ボタン**|ボタン|**最重要アクション。** 押下で「記録画面」へ遷移。|
|**提案バナー**|通知|画面右下に固定表示される通知形式のバナー。条件を満たした場合のみ表示され、×ボタンで閉じることができる。|

---

## 2. ホーム画面（Dashboard）

「過去の学習履歴」を一覧し、モチベーションを維持する画面です。

### デイリーレポートカード一覧

過去の学習記録をグリッド形式（2-3列）で表示します。新しい順（今日が最上位）に並びます。

#### カードの構成要素

各カードには以下の情報を表示：

- **日付**: 「2025年12月31日（火）」形式で表示

- **達成度バッジ**: Bronze / Silver / Gold / 未記録 のいずれかを色付きバッジで表示

- **学習内容サマリー**:

    - ユーザーが入力した学習内容を箇条書き形式（最大3件）で表示

    - 入力がない場合は「学習内容の記録なし」と表示

- **日報の抜粋**:

    - 自由記述（Journal）がある場合、冒頭100文字程度を表示

    - ない場合は「日報なし」と表示

- **カードクリック**: カード全体がクリッカブル。押下でその日の「日詳細画面（読み取り専用）」へ遷移


#### 表示件数とレイアウト

- グリッド表示: PC画面で見栄えが良いように2-3列のグリッドレイアウトで表示
- 初期表示: 直近の記録を表示（PCで最適な表示となる日数）


### 提案バナー（共通レイアウト）

画面右下に固定表示される通知形式のバナーです。条件を満たした場合のみ表示されます。

- **表示位置**: 画面右下に固定
- **閉じる機能**: ×ボタンで閉じることができる
- **メッセージ**: 「レベルアップの条件を満たしました」or「目標をレベルダウンしませんか？」等のテキスト
- **アクションボタン**: 押下で「目標編集画面」へ遷移

#### 表示条件と編集権限
- **レベルアップ提案**:
    - **Gold を14日連続達成**: Gold目標のみ編集可能
    - **Silver を14日連続達成**: Silver目標のみ編集可能
    - **Bronze を14日連続達成**: Bronze目標のみ編集可能
    - **注意**: 「14日連続達成」とは、ちょうど14日目、28日目、42日目...（14の倍数日）を意味します。15日目、16日目など14の倍数でない日は提案バナーを表示しません。
- **レベルダウン提案**: 1週間のうち、Bronzeすら4日以上達成できなかった場合（全目標の編集が可能）

#### 表示期間と再表示ルール
- **表示期間**: 条件を達成した当日のみ表示。日付が変わると自動的に非表示になる
  - 例：1月13日に14日連続達成（14日目）→  1月13日のみ提案バナー表示、1月14日（15日目）からは非表示
- **再表示条件**: ユーザーが提案を無視（レベル変更しない）した場合でも、再度14日連続を達成すれば再び提案バナーを表示する
  - 例1: Bronze→Silver提案を無視 → さらに14日連続達成（合計28日連続）→ 28日目に再度Bronze→Silver提案が表示される
  - 例2: 14日目に提案表示 → 15日目は非表示 → ... → 28日目に再度提案表示
        

---
## 3. 記録・日報画面（Daily Recording）

その日の学習成果を記録し、振り返りを行う画面です。

### 学習内容サマリー（必須）

- **入力形式**: 箇条書き形式で複数項目を入力（テキストエリア）
- **プレースホルダー**: 「なし」（灰色で表示）
- **入力例**:
    - Reactのコンポーネント設計を学習
    - TypeScriptの型定義を復習
    - データベーススキーマの設計
- **補足**: 何も作業していない場合は「なし」と入力

### 目標達成度（3-Step Cards）

その日の実際の達成度を選択します。

| **Bronze** | **Silver** | **Gold**   |
| ---------- | ---------- | ---------- |
| **「最低限」**  | **「計画通り」** | **「期待以上」** |
| 30分だけ座る    | 1機能完成      | リファクタまで完了  |
| [ 選択する ]   | [ 選択する ]   | [ 選択する ]   |

### 自由記述（Journal）（任意）

- **内容**: 今日感じたこと、学んだこと、自分への褒め言葉など
- **入力形式**: テキストエリア

---

### アクションボタン

- **[ 記録を確定してロックする ]**

    - ※保存後、今日の記録は読み取り専用になり、ダッシュボードへ遷移します。
        

---


## 4. 目標編集画面（Goal Adjustment）

**提案バナー経由でのみアクセス可能**。「目標そのもの」を書き換える画面です。

### アクセス条件

- **レベルアップ提案時（14日連続達成）**: 提案バナーのボタンから遷移可能
- **レベルダウン提案時（7日中4日未達）**: 提案バナーのボタンから遷移可能
- **上記以外**: 目標編集画面へのアクセスは不可（編集ロック状態）

### 編集入力フォーム

- **Bronze目標入力**: テキストボックス。
- **Silver目標入力**: テキストボックス。
- **Gold目標入力**: テキストボックス。

### 更新ボタン

- 入力した内容を新しい基準として保存
- 保存時、現在の目標期間（スロット）が確定し、新しい目標期間が開始される
- 目標変遷画面のタイムラインに新しいスロットが追加される

---

## 5. 目標変遷画面（Goal History Timeline）

目標（Bronze/Silver/Gold）の変遷を、横スクロールのタイムライン形式で可視化する画面です。**各目標レベル（Bronze/Silver/Gold）は独立して管理され**、それぞれが特定の条件（14日連続達成、または7日中4日未達）によって個別に変更されます。目標ごとの変更履歴を、直感的に振り返ることができます。

### アクセス方法

- サイドバーのメニュー項目「目標変遷」から遷移
- メニュー順序: ホーム → 記録 → カレンダー → 目標変遷 → 設定

### 画面構成要素

#### ① 目標カード（独立したカード表示）

**各目標レベル（Bronze/Silver/Gold）は個別のカードとして表現されます。**

**レイアウト:**
- **時系列方向**: 横スクロール（左→右）で過去から現在へ進む
- **カード配置**: 各時点でBronze → Silver → Goldの順に縦に積み重ねて表示
- **時間軸での整列**: 横軸を共通の時間軸として、各目標カードをその開始日・終了日に応じて配置する
  - 目標ごとに期間が異なる場合、Bronze/Silver/Goldのカードが横方向にずれて表示される
  - これにより、どの目標がいつ変更されたのかを視覚的に把握できる

**カードの表示内容:**
- **目標レベル**: Bronze / Silver / Gold のラベル
- **目標内容**: 設定されていた具体的な内容（例：「毎日20分ランニング」）
- **実施期間**: その目標が有効だった期間（例：2026/01/01 - 2026/01/14）
- **カード幅**: その目標が有効だった期間の長さに比例（長期間続いた目標ほど幅が広くなる）

**現在進行中の目標（最新）:**
- **3つの目標すべてに表示**:
  - Bronze、Silver、Goldそれぞれに鍵マークアイコンを表示
  - 各目標ごとに進捗インジケーターを表示（例：「現在のストリーク: 7日 / 14日」）
  - 現在の連続達成日数が、各目標レベルごとに個別に表示される

#### ② 遷移コネクター（矢印アイコン）

**各目標カードの間に個別に配置され**、その目標が変わった理由を明示します。

**レベルアップ矢印 (↗️):**
- **発生条件**: その目標レベルで14日間連続達成時
- **デザイン**: 右斜め上を指す太い矢印。ポジティブな色（青や緑）
- **ラベル**: 「14日連続達成」
- **表示位置**: 同じレベルのカード間（例：Bronze→Bronzeの次のカード）

**レベルダウン矢印 (↘️):**
- **発生条件**: その目標レベルで7日中4日未達時
- **デザイン**: 右斜め下を指す矢印。警告を示す色（赤やオレンジ）
- **ラベル**: 「目標調整」
- **表示位置**: 同じレベルのカード間（例：Silver→Silverの次のカード）

**表示ルール:**
- 上記の条件を満たして目標が変更された場合のみ、該当するカード間に矢印とラベルを表示
- Bronze、Silver、Goldそれぞれが独立して矢印を持つことができる
- 条件未達成時は矢印を表示しない（カードのみが並ぶ）

### インタラクション

- **横スクロール**: 画面を左右にスワイプ（またはスクロール）することで、過去から現在までの履歴を時系列で閲覧
- **初期表示位置**: 最新の目標カード（一番右）が画面右端に表示される
- **初回起動時**: カードが1つもない場合、「まだ目標変更履歴がありません」のようなメッセージを表示
- **詳細表示**: 将来的な機能として残す（現時点では実装不要）

### ビジネスロジック（目標変更ルール）

**目標の独立性:**
- Bronze、Silver、Goldの各目標は**完全に独立して管理される**
- それぞれの目標が個別に14日連続達成または7日中4日未達の条件を満たした場合、その目標のみが変更される
- 例：Bronzeが14日連続達成でレベルアップしても、SilverとGoldは変更されない

**目標変更のタイミング:**
- 目標編集画面で「更新ボタン」を押した瞬間に、変更対象の目標の現在のカードが確定
- 新しいカードが作成され、タイムラインの該当位置（時間軸上）に追加される
- 変更されなかった目標は、前のカードが継続される（新しいカードは作成されない）

**目標変更の前提条件:**
- 提案バナー経由でのみ目標編集画面へアクセス可能
- **レベルアップ提案時**: 14日連続達成した目標のみ編集可能
  - 例：Goldを14日連続達成した場合、Gold目標のみ編集可能
- **レベルダウン提案時**: 7日中4日未達の場合、全目標の編集が可能

---

## 6. カレンダー画面（Monthly Overview）

過去の頑張りを振り返るための画面です。

- **月次カレンダー**:
    
    - **日付セル**: 達成度に応じたカラー（銅・銀・金）で塗りつぶし、またはドットを表示。
        
    - **ホバーツールチップ**: 日付にマウスを乗せると「その日の目標」と「日報の冒頭」をポップアップ表示。
        
- **詳細リンク**: 日付クリックで、その日の「日詳細画面（読み取り専用）」へ。

### 日詳細画面（読み取り専用）

カレンダーから遷移する、過去の記録を閲覧する画面です。

- **表示内容**: その日の記録・日報画面で入力した全ての内容を表示
    - 日付
    - 達成度（Bronze/Silver/Gold）
    - 学習内容サマリー
    - 自由記述（Journal）

- **編集不可**: 確定後の記録は編集できず、読み取り専用として表示される。
    

---

## 6. 設定画面（Settings）

学習管理のルールを確認する画面です。

### ルール確認

- **レベルアップ提案**: 同じレベルを14日連続で達成した場合、目標をレベルアップすることを提案します。
- **レベルダウン提案**: Bronze未達が4日以上続いた場合、目標をレベルダウンすることを提案します。無理のないペースで続けることが大切です。

### 注意事項

- **GitHub連携機能は実装しません**: 外部サービスとの連携は行わず、学習管理に集中したシンプルな設計とします。


---

### UX向上のための「カラーパレット」提案

PC画面で長時間見ても疲れず、かつ「達成感」を感じられる配色です。

|**状態**|**推奨カラー**|**イメージ**|
|---|---|---|
|**未達**|`#E5E7EB` (Gray 200)|背景に溶け込む控えめな色。|
|**Bronze**|`#CD7F32` (Bronze)|落ち着いた銅色。温かみのあるブラウン。|
|**Silver**|`#94A3B8` (Slate 400)|洗練された銀色。少し青みのあるグレー。|
|**Gold**|`#F59E0B` (Amber 500)|鮮やかな金色。最も目立つ、達成の象徴。|

---

## 8. ユーザーフロー

### 初回利用時のフロー

新規ユーザーが最初にアプリを利用する際の流れです。

1. **サインアップ画面にアクセス**
    - メールアドレスとパスワードを入力してアカウント作成

2. **メール確認**
    - Supabaseから送信された確認メールのリンクをクリック

3. **ログイン**
    - ログイン画面でメールアドレスとパスワードを入力

4. **初期目標設定画面へ自動遷移**
    - 初回ログイン時は目標が未設定のため、自動的に初期目標設定画面へ遷移
    - Bronze/Silver/Goldの3つの目標を入力

5. **ホーム画面へ遷移**
    - 目標保存後、自動的にホーム画面へ遷移
    - 学習記録を開始できる状態になる

---

## 9. 日常的なユーザーフロー

### 毎日のサイクル

ユーザーが毎日通る基本的な流れです。

1. **記録画面へアクセス**
    - ヘッダーの「記録ボタン」から記録画面へ遷移

2. **その日の成果を記録**
    - 学習内容サマリーを入力（何を学んだか）
    - 達成度を選択（Bronze / Silver / Gold）
    - 自由記述で振り返りを記入（任意）

3. **記録を確定**
    - 「記録を確定してロックする」ボタンを押下
    - 記録が読み取り専用になり、ダッシュボードへ遷移

4. **過去の記録を振り返る**
    - ダッシュボードで過去の学習履歴を確認
    - カレンダー画面で月次の達成状況を俯瞰

### 目標調整のフロー

1. **提案バナーの表示**
    - レベルアップ条件達成時（14日連続達成）
    - レベルダウン提案時（7日中4日未達）

2. **目標編集画面へ遷移**
    - 提案バナーのボタンから目標編集画面へ

3. **目標を更新**
    - 新しい目標内容を入力
    - 更新ボタンで保存