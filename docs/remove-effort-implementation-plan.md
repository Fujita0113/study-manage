# 工夫管理機能 削除実装計画

## 目的

要件定義の変更に伴い、工夫管理関連の機能を実装から削除し、MVPに必要な核心機能のみに集中する。

---

## 削除対象の概要

### 1. データモデル
- `Effort`（工夫）エンティティ
- `EffortEvaluation`（工夫の評価）エンティティ

### 2. 画面・ページ
- 工夫管理画面（`/efforts`）
- 記録画面の工夫関連セクション（CHECK/ACT/PLAN）

### 3. コンポーネント・ロジック
- 工夫の状態管理
- 工夫の評価・更新ロジック
- Step-Up Strategy 機能

---

## 作業項目詳細

### フェーズ1: データモデルの整理

#### 1.1 TypeScript型定義の更新

**ファイル**: [types/index.ts](../types/index.ts)

**削除する型:**
- `EffortStatus`
- `Effort`
- `EffortExecuted`
- `EffortEffectiveness`
- `EffortNextAction`
- `EffortEvaluation`

**修正する型:**
- `DailyRecord`: 工夫関連のフィールドを削除
  - 削除: `plan_new_effort_text`, `step_up_strategy_text` など（存在する場合）

#### 1.2 data-model.mdの更新

**ファイル**: [docs/data-model.md](./data-model.md)

**削除するセクション:**
- セクション3「Effort（工夫）」
- セクション5「EffortEvaluation（工夫の評価）」
- ERD図から Effort と EffortEvaluation を削除
- リレーションシップの説明から工夫関連を削除
- 「改良して継続」を選択した場合の処理に関する特記事項

**修正するセクション:**
- セクション4「DailyRecord」のPDCAサイクルの説明を削除
- Step-Up Strategyの説明を削除

---

### フェーズ2: データベースの整理

#### 2.1 データベーススキーマの更新

**ファイル**: [lib/db.ts](../lib/db.ts)

**削除する処理:**
- `efforts` テーブル関連の操作（存在する場合）
- `effort_evaluations` テーブル関連の操作（存在する場合）

**注意事項:**
- 実際のSupabaseデータベースからテーブルを削除する場合は、データのバックアップを取得してから実行
- マイグレーションスクリプトがある場合は、rollback用のスクリプトも作成

#### 2.2 モックデータの更新

**ファイル**: [lib/mockData.ts](../lib/mockData.ts)

**削除する処理:**
- 工夫（Effort）のモックデータ
- 工夫評価（EffortEvaluation）のモックデータ

---

### フェーズ3: ページ・コンポーネントの削除

#### 3.1 工夫管理画面の削除

**ファイル**: [app/efforts/page.tsx](../app/efforts/page.tsx)

**対応:**
- ファイル全体を削除
- または、将来の実装のためにコメントアウトして別ディレクトリに移動

#### 3.2 記録画面の簡素化

**ファイル**: [app/record/page.tsx](../app/record/page.tsx)

**削除するセクション:**
- STEP 1: CHECK（前日からの工夫の答え合わせ）
- STEP 3: ACT（工夫のステータス更新）
- STEP 4: PLAN（明日を楽にする新しい工夫）
- STEP 5: Step-Up Strategy（次のレベルへの架け橋）

**残すセクション:**
- 学習内容サマリー（DO）
- 目標達成度（3-Step Cards）
- 自由記述（Journal）
- 記録を確定してロックするボタン

#### 3.3 日詳細画面の簡素化

**ファイル**: [app/day/[date]/page.tsx](../app/day/[date]/page.tsx)

**削除する表示:**
- 工夫の評価内容（実行フラグ、実感効果）
- 工夫のステータス更新内容
- 新しい工夫の内容
- Step-Up Strategyの内容

**残す表示:**
- 日付
- 達成度（Bronze/Silver/Gold）
- 学習内容サマリー
- 自由記述（Journal）

---

### フェーズ4: ナビゲーション・UIの更新

#### 4.1 サイドバー・ナビゲーションの更新

**ファイル**: [components/layout/Sidebar.tsx](../components/layout/Sidebar.tsx)

**削除する項目:**
- 工夫管理画面へのリンク（`/efforts`）

**確認する項目:**
- ホーム（ダッシュボード）
- 記録
- カレンダー
- 目標設定
- 設定

#### 4.2 アイコンの整理

**ファイル**: [components/icons.tsx](../components/icons.tsx)

**削除する可能性のあるアイコン:**
- 工夫管理画面専用のアイコン（該当するものがあれば）

---

### フェーズ5: ユーティリティ・ロジックの整理

#### 5.1 状態管理の整理

**ファイル**: [lib/store.tsx](../lib/store.tsx)（存在する場合）

**削除する状態:**
- 工夫リスト
- 工夫評価の状態
- 工夫関連のアクション

#### 5.2 ユーティリティ関数の整理

**ファイル**: [lib/utils.ts](../lib/utils.ts)

**削除する関数:**
- 工夫のステータス変更ロジック
- 工夫のフィルタリング・ソート機能
- scheduled → active への自動変更ロジック

---

### フェーズ6: テストとバリデーション

#### 6.1 動作確認項目

以下の画面・機能が正常に動作することを確認：

1. **ホーム画面（ダッシュボード）**
   - デイリーレポートカードの表示（達成度、学習内容、日報抜粋）
   - カードクリックで日詳細画面への遷移

2. **記録・日報画面**
   - 学習内容サマリーの入力
   - 達成度の選択（Bronze/Silver/Gold）
   - 自由記述の入力
   - 記録の確定とロック

3. **日詳細画面（読み取り専用）**
   - 日付、達成度、学習内容、日報の表示
   - 編集不可の確認

4. **カレンダー画面**
   - 月次カレンダーの表示
   - 達成度に応じた色分け
   - 日付クリックで日詳細画面への遷移

5. **目標編集画面**
   - 提案バナー経由での遷移
   - Bronze/Silver/Gold目標の編集

6. **設定画面**
   - ルール確認の表示

#### 6.2 エラーチェック

- コンパイルエラーがないことを確認
- TypeScriptの型エラーがないことを確認
- 削除したコンポーネントへの参照が残っていないことを確認
- リンク切れがないことを確認

---

## 実装の優先順位

### 高優先度（先に実施）
1. **TypeScript型定義の更新** ([types/index.ts](../types/index.ts))
2. **記録画面の簡素化** ([app/record/page.tsx](../app/record/page.tsx))
3. **ナビゲーションの更新** ([components/layout/Sidebar.tsx](../components/layout/Sidebar.tsx))

### 中優先度
4. **工夫管理画面の削除** ([app/efforts/page.tsx](../app/efforts/page.tsx))
5. **日詳細画面の簡素化** ([app/day/[date]/page.tsx](../app/day/[date]/page.tsx))
6. **モックデータの更新** ([lib/mockData.ts](../lib/mockData.ts))

### 低優先度（後で実施可）
7. **データベーススキーマの整理** ([lib/db.ts](../lib/db.ts))
8. **data-model.mdの更新** ([docs/data-model.md](./data-model.md))
9. **ユーティリティ関数の整理** ([lib/utils.ts](../lib/utils.ts))

---

## 注意事項

### データの保護
- 既存のデータベースに工夫関連のデータが存在する場合、削除前にバックアップを取得すること
- テーブル削除は慎重に行い、必要に応じてマイグレーションスクリプトを作成

### 段階的な削除
- 一度にすべてを削除せず、フェーズごとに動作確認を行うこと
- 各フェーズ完了後、コミットして作業履歴を残すこと

### 将来の拡張に備えて
- 削除したコードは完全に破棄せず、別ブランチまたは[future-features.md](./future-features.md)に記録
- データモデルの設計は[docs/data-model.md](./data-model.md)に残しておく（コメントアウトまたは別セクションとして）

---

## 完了条件

以下がすべて満たされた時点で作業完了とする：

- [ ] すべての工夫関連の型定義が削除されている
- [ ] 記録画面がシンプルな構成（学習内容、達成度、日報のみ）になっている
- [ ] 工夫管理画面へのリンクがナビゲーションから削除されている
- [ ] コンパイルエラー、型エラーがゼロになっている
- [ ] すべての画面が正常に表示・動作する
- [ ] リンク切れがない
- [ ] data-model.mdが更新され、工夫関連の記述が削除または移動されている

---

## 推定作業時間

- フェーズ1: 30分
- フェーズ2: 20分
- フェーズ3: 1時間
- フェーズ4: 15分
- フェーズ5: 30分
- フェーズ6: 30分

**合計**: 約3時間

---

## 関連ドキュメント

- [requirements.md](./requirements.md) - 更新済みの要件定義
- [future-features.md](./future-features.md) - 工夫管理機能のアイデア保管場所
- [data-model.md](./data-model.md) - データモデル定義（更新が必要）
