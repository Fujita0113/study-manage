# Claude Code 作業ガイドライン

このドキュメントは、このプロジェクトにおけるClaude Codeの作業方針を定義します。

---

## 重要原則

### 1. 不明瞭な内容は必ず質問する

ユーザーからの指示に**不明瞭な内容や曖昧な要素がある場合、絶対に作業を開始しないでください。**

**必ず明確になるまで質問し返すこと。**

#### 質問すべき例：
- 「この機能を追加して」→ どこに？どのような仕様で？どのレベル（Bronze/Silver/Gold）に紐づく？
- 「デザインを変更して」→ どの画面の？どの要素を？どのように？
- 「バグを修正して」→ どのバグ？どの画面で？どの操作で発生する？
- 「ここを改善して」→ 何を改善する？どのような状態が理想？

#### 質問の仕方：
- AskUserQuestionツールを使用して、選択肢形式で確認する
- 複数の解釈が可能な場合は、それぞれの選択肢を明示する
- 不足している情報を具体的に尋ねる

**不明瞭なまま推測で作業を進めることは禁止です。**

---

### 2. requirements.mdを唯一の真実とする

[docs/requirements.md](docs/requirements.md)は、このプロジェクトの**唯一の絶対正しい情報源**です。

#### ユーザーが変更を依頼した場合の必須手順：

1. **必ず最初に**[docs/requirements.md](docs/requirements.md)**を更新する**
2. requirements.mdの更新内容をユーザーに確認してもらう
3. 承認を得てから、実際のコード変更作業を開始する

#### requirements.md更新の対象となる変更：
- 画面仕様の変更（レイアウト、表示内容、動作）
- データモデルの変更（新しいフィールド、構造変更）
- ビジネスロジックの変更（判定ルール、計算方法）
- ユーザーフローの変更（画面遷移、操作手順）
- 新機能の追加
- 既存機能の削除

#### 作業の流れ：

```
ユーザーの変更依頼
    ↓
不明点があれば質問（AskUserQuestion）
    ↓
requirements.mdを更新
    ↓
更新内容をユーザーに確認
    ↓
承認を得る
    ↓
実際のコード実装を開始
```

#### 例外：
以下の場合はrequirements.mdの更新は不要です：
- バグ修正（要件通りに動いていない箇所の修正）
- リファクタリング（機能や仕様に影響しない内部構造の改善）
- コードの最適化（パフォーマンス改善など、ユーザー体験に影響しない変更）
- タイポ修正

ただし、バグ修正であっても**仕様の解釈に疑問がある場合は、必ずユーザーに確認してください。**

---

## 作業フロー

### 標準的な作業の進め方

1. **要件の確認**
   - ユーザーの依頼内容を理解する
   - 不明点があればAskUserQuestionで質問する

2. **requirements.mdの確認**
   - 関連する要件を[docs/requirements.md](docs/requirements.md)で確認する
   - 既存の仕様との整合性をチェックする

3. **requirements.mdの更新（変更の場合）**
   - 変更内容をrequirements.mdに反映する
   - ユーザーに更新内容を確認してもらう

4. **実装計画の作成（必須）**
   - **実装を開始する前に、必ずdocs配下に実装計画ドキュメントを作成すること**
   - ファイル名は `docs/[タスク名]-plan.md` の形式
   - 計画には以下を含める：
     - 作業の目的と概要
     - 変更が必要なファイルのリスト
     - 各ファイルでの具体的な変更内容
     - 実装手順（ステップバイステップ）
     - 想定される影響範囲
     - テスト方針
   - 計画をユーザーに確認してもらう
   - **計画なしに実装を開始することは絶対に禁止**

5. **実装**
   - requirements.mdと作成した実装計画に基づいて実装する
   - 既存コードとの一貫性を保つ
   - 計画に沿って段階的に進める
   - TodoWriteツールで進捗を管理する

6. **確認**
   - requirements.mdの要件を満たしているか確認する
   - 実装計画通りに実装できているか確認する
   - ユーザーに動作確認を依頼する

---

## バグ修正時の特別ルール

### 新たなバグ発見時の対応

バグ修正作業中に、**元の修正対象とは異なる別のバグを発見した場合**：

1. **作業を一旦停止する**
   - 現在の修正作業を中断する

2. **新たなバグをユーザーに報告する**
   - どのような問題を発見したか説明する
   - 元の修正対象との関連性を説明する
   - 発見場所と想定される原因を報告する

3. **ユーザーの指示を待つ**
   - 新しいバグを先に修正すべきか確認する
   - 元の修正を続けるべきか確認する
   - 両方を対応する場合の優先順位を確認する

4. **指示に従って作業を再開する**
   - 必要に応じて実装計画を更新する
   - TodoWriteで新しいタスクを追加する

**重要**: 発見した新しいバグを勝手に修正したり、無視して元の作業を続けることは禁止です。必ずユーザーに報告して指示を仰いでください。

---

## 禁止事項

以下の行為は**絶対に禁止**です：

1. **不明瞭な指示のまま作業を進める**
   - 必ず明確になるまで質問すること

2. **requirements.mdを更新せずに仕様変更する**
   - 変更の場合は必ずrequirements.mdを先に更新すること

3. **推測で要件を解釈する**
   - 複数の解釈が可能な場合は必ずユーザーに確認すること

4. **requirements.mdと矛盾する実装をする**
   - requirements.mdが常に正しい情報源です

5. **実装計画を作成せずに実装を開始する**
   - 必ずdocs配下に実装計画ドキュメントを作成してから実装すること

6. **バグ修正中に発見した別のバグを勝手に修正する、または無視する**
   - 必ずユーザーに報告して指示を仰ぐこと

---

## その他の注意事項

- requirements.mdに記載されていない詳細仕様については、既存のコードを参照するか、ユーザーに確認してください
- データモデルの詳細は[docs/data-model.md](docs/data-model.md)を参照してください
- コードの一貫性を保つため、既存のコーディングスタイルに従ってください
